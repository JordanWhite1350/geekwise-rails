# Day 9: Advanced Associations

We'll begin developing on the [Day 9](https://github.com/djreimer/flutter/tree/day-9) branch of [Flutter](https://github.com/djreimer/flutter). If you followed along through last class, you can continue on in your own repository.

Or, feel free to `clone` my repository and `checkout` the branch:

    $ git clone https://github.com/djreimer/flutter.git
    $ cd flutter
    $ git checkout day-9

If you already have cloned my repository, `fetch` all changes, then `checkout` the branch:

    $ cd flutter
    $ git fetch origin
    $ git checkout -t origin/day-9

## Advanced Link Helpers

Wire up this dummy link and use the `link_to` helper.

```html
<a href="#" class="user">
  <span class="full-name"><%= status.user.full_name %></span>
  <span class="screen-name">@<%= status.user.screen_name %></span>
</a>
```

## Default Scopes

Use a `default_scope` to ensure that statuses are always displayed in the right order.

## Add Gravatars

**Exercise:** Use the [gravatar_image_tag](https://github.com/mdeering/gravatar_image_tag) gem to display user avatars in statuses and the user profile page. Follow the instructions in the README.

## Followers

Last class we learned about one-to-many relationships. Using similar techniques, we need to implement following/followed relationships.

### Plan out the public API

First, we should map out the public API.

```ruby
user = User.find(1)
another_user = User.find(2)

# Create a relationship between user and another_user
user.follow(another_user)

# Retrieve a collection those who the user has followed
user.followed_users
#=> [another_user]

# Retrieve a collection of users who follow the user
another_user.follower_users
#=> [user]
```

This is the behavior we will need to test.

**Exercise:** Write basic tests for the `follow` method.

### Create a join table

**Discuss:** How should we implement this in the database? Map out on the whiteboard.

**Exercise:** Use a Rails generator to create our new table. **Do not** run `rake db:migrate` yet.

### Add relationships

Resources:

- [has_many documentation](http://api.rubyonrails.org/classes/ActiveRecord/Associations/ClassMethods.html#method-i-has_many)
- [Active Record Associations - Has Many Through](http://guides.rubyonrails.org/association_basics.html#the-has-many-through-association)