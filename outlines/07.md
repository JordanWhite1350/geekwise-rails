# Day 7: Associations

**Please clone my repository and begin on the `day-7` branch, even if you followed along last class.**

We'll begin developing on the [Day 7](https://github.com/djreimer/flutter/tree/day-7) branch of [Flutter](https://github.com/djreimer/flutter). I've added various styles and markup to the project.

    $ git clone https://github.com/djreimer/flutter.git
    $ cd flutter
    $ git checkout day-7

If you already have cloned my repository, `fetch` all changes, then `checkout` the branch:

    $ cd flutter
    $ git fetch origin
    $ git checkout -t origin/day-7

## What Changed

[Take a look at the diff](https://github.com/djreimer/flutter/compare/day-6...day-7) on GitHub to see a high level overview.

## Logging Out

**Discuss:** How should we implement this?

- Which controller?
- Which action?
- Which verb (GET, POST, PUT/PATCH, DELETE)?

Introduce singular resources.

**Exercise:** Convert sessions into a singular resource. Make sure all tests pass. Do your best to interpret test errors and fix them.

Resources:

- [Rails Routing Guide / Singular Resources](http://guides.rubyonrails.org/routing.html#singular-resources)

## User Settings Form

**Discuss:** How should we implement this?

- Which controller?
- Which action?
- Which verb (GET, POST, PUT/PATCH, DELETE)?

**Exercise:** Finish out the settings form. Hint: you can pass a hash of data to the `update_attributes` method on model objects to update fields.

## Reducing Duplication with Partials

Let's extract the error messages markup into a partial.

## Restricting Access

**Discuss:** Suppose someone tries to go to a restricted area (like the user settings page) and is not logged in. What should we do?

Introduce `before_action` hooks and define an `authenticate_user!` method.

## Associating Statuses with Users

We need to setup a one-to-many relationship between users and statuses. Let's generate a Rails migration for this and then wire up the ActiveRecord associations.

At this point, it's probably best to nuke our development database: `rake db:reset`.

Resources:

- [Active Record Associations](http://guides.rubyonrails.org/association_basics.html)

## New Status Form

It's easy to create associated objects:

    user.statuses.create(status_params)

Explore in the Rails console.

**Exercise:** Build a form for creating new statuses.

Then, create a link in the top navigation to the form.

## Profile Pages

**Discuss:** How should we implement this?

- Which controller?
- Which action?
- Which verb (GET, POST, PUT/PATCH, DELETE)?

It would be better if we could reach the profile page like Twitter:

    http://localhost:3000/derrickreimer

To accomplish this, we to manually configure a route (not using the `resources` helper):

    {verb} "{path}" => "{controller}#{action}", :as => "{name}"

## Add Gravatars

**Exercise:** Use the [gravatar_image_tag](https://github.com/mdeering/gravatar_image_tag) gem to display user avatars in statuses and the user profile page. Follow the instructions in the README.
