# Day 4: Conditional Validations, Callbacks, and Testing

We'll begin developing on the [Day 4](https://github.com/djreimer/flutter/tree/day-4) branch of [Flutter](https://github.com/djreimer/flutter). If you followed along through last class, you can continue on in your own repository.

Or, feel free to `clone` my repository and `checkout` the branch:

    $ git clone git@github.com:djreimer/flutter.git
    $ cd flutter
    $ git checkout day-4

If you already have cloned my repository, `fetch` all changes, then `checkout` the branch:

    $ cd flutter
    $ git fetch origin
    $ git checkout -t origin/day-4

## Password Validations

Last time we implemented a `password` virtual attribute. Now we can add validation logic.

**Discuss:** What kind of validations do we need for passwords?

Introduce conditional validations.

## Password Encryption

To auto-generate the hash and salt, we need to define a method that will get called before the object is saved.
Callbacks to the rescue!

[See the API docs](http://api.rubyonrails.org/classes/ActiveRecord/Callbacks.html) for a list of all the ActiveRecord callbacks.

In this case, we'll use the `before_save` callback.

### BCrypt

BCrypt is nice encryption library. Add to the Gemfile:

    gem 'bcrypt-ruby', '~> 3.0.0'

Then, `require 'bcrypt'` in your `User` class.

We will use two different methods provided by this library:

- `BCrypt::Engine.generate_salt` to generate salt
- `BCrypt::Engine.hash_secret(password, salt)` to cipher the password

More info on the [BCrypt algorithm](http://en.wikipedia.org/wiki/Bcrypt)

### Callbacks

Implement an `encrypt_password` callback that generates a salt and hashed password.

**Discuss:** What do we need to do in this method?